Автозагрузчик модулей Битрикс, который поможет вам почти навсегда забыть про вызовы CModule::IncludeModule и 
Loader::includeModule


Как использовать:
-----------------

1 Установите через composer: 

`composer require webarchitect609/bitrix-neverinclude`

2 Если необходимо, то в init.php укажите список модулей, которые следует исключить из обработки данного автолоадера:

`\WebArch\BitrixNeverInclude\BitrixNeverInclude::addExcludedModules(['foo.bar',]);`

Сейчас известна несовместимость с модулем 'sprint.migration', поэтому он исключается автоматически.  

3 В init.php после подключения `vendor/autoload.php` добавьте вызов: 

`\WebArch\BitrixNeverInclude\BitrixNeverInclude::registerModuleAutoload();`

4 Обязательно ознакомьтесь с известными проблемами (см. ниже), т.к. эта библиотека, к сожалению, не может исправить все 
проблемы Битрикса. 

5 И наслаждайтесь более интересными заботами, чем подключение модулей! :)


Особенности реализации:
-----------------------

1 Классы не из глобального namespace разбираются динамически и превращаются в название модуля, 
который тут же подключается.

2 Классы из глобальной области проверяются по маппингу "имя класса => имя модуля", для вычисления которого делается 
подключение всех установленных в системе модулей и производится сбор внутренних данных, которые потом кешируются. 


Известные проблемы:
--------------------------------------------

1 **Если происходит вызов функции, объявленной в модуле, до использования класса из этого модуля**, то требуется явно 
подключить модуль традиционным способом в связи с невозможностью реализации в php автозагрузки функций. 

```
<?php

require_once($_SERVER['DOCUMENT_ROOT'] . '/bitrix/header.php');

/**
 * Без явного подключения модуля будет ошибка 
 * из-за отсутствия определения функции SaleFormatCurrency
 */
\Bitrix\Main\Loader::includeModule('sale');

$foo = SaleFormatCurrency(101.22, 'USD');

``` 

2 **Несовместимые модули**. Некоторые сторонние модули могут быть не совместимы с данной библиотекой, поэтому должны 
быть добавлены в исключения (см. выше) и их придётся подключать вручную. Это происходит, например, если в `include.php` 
такого модуля осуществляется вызов `spl_autoload_register()`. 

3 **Если происходит установка нового модуля, использующего классы в глобальной области**, кеш маппинга 
"имя класса => имя модуля" будет неактуальным. Рекомендуется сбросить его по тегу следующим образом: 

```

$tagCache = \Bitrix\Main\Application::getInstance()->getTaggedCache();
$tagCache->clearByTag(\WebArch\BitrixNeverInclude\BitrixNeverInclude::CACHE_TAG);

```

А прогреть такой кеш можно через `\WebArch\BitrixNeverInclude\BitrixNeverInclude::getClassMapping();`
